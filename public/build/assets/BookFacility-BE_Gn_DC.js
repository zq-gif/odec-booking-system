import{r as c,b as f,j as e,H as E}from"./app-0vcdSfH5.js";import{A as H,k as N,j as O}from"./AuthenticatedLayout-DafAQUhz.js";import{F as v}from"./CalendarIcon-B7fKRW7W.js";import{F as U,a as I,b as L,c as Q}from"./PrinterIcon-D5CSdoYf.js";import{F as w}from"./CheckCircleIcon-DE-J4yg-.js";import{F as G}from"./MapPinIcon-BY4acTXJ.js";import{F as V}from"./ClockIcon-DLebh5by.js";function ee({auth:u,facilities:k,paymentQrCode:m}){const[t,g]=c.useState(1),[S,F]=c.useState(""),[C,B]=c.useState([]),[_,j]=c.useState(!1),[s,n]=c.useState({facility:null,date:"",time:"",name:u.user.name,email:u.user.email,phone:"",attendees:"",purpose:"",paymentMethod:"",receiptFile:null}),M=(()=>{const a=s.facility?.slot_duration||4,r=[],o=8,p=22;for(let i=o;i+a<=p;i+=a){const b=i.toString().padStart(2,"0")+":00",l=(i+a).toString().padStart(2,"0")+":00",d=i<12?`${i}:00 AM`:i===12?"12:00 PM":`${i-12}:00 PM`;r.push({value:b,label:d,endTime:l,duration:a})}return r})();c.useEffect(()=>{s.facility&&s.date&&$()},[s.facility,s.date]);const $=async()=>{j(!0);try{const a=await f.get("/api/facility-bookings/booked-slots",{params:{facility_id:s.facility.id,date:s.date}});B(a.data)}catch(a){console.error("Error fetching booked slots:",a)}j(!1)},D=a=>C.some(r=>r.start_time===a+":00"||r.start_time===a),y=[{number:1,name:"Select Facility",icon:N},{number:2,name:"Choose Date & Time",icon:v},{number:3,name:"Enter Details",icon:N},{number:4,name:"Payment",icon:U},{number:5,name:"Confirmation",icon:I}],h=()=>{t<5&&g(t+1)},P=()=>{t>1&&g(t-1)},R=a=>{n({...s,facility:a}),h()},x=()=>{if(!s.facility?.price_per_hour)return 0;const a=s.facility?.slot_duration||4;return(parseFloat(s.facility.price_per_hour)*a).toFixed(2)},T=()=>{window.print()},A=async a=>{a.preventDefault();const r=s.facility?.slot_duration||4,o=s.time,[p]=o.split(":"),b=`${(parseInt(p)+r).toString().padStart(2,"0")}:00`;try{const l=new FormData;l.append("facility_id",s.facility.id),l.append("booking_date",s.date),l.append("start_time",o),l.append("end_time",b),l.append("duration_hours",r),l.append("number_of_guests",parseInt(s.attendees)),l.append("purpose",s.purpose),l.append("phone_number",s.phone),l.append("payment_method",s.paymentMethod),s.receiptFile&&l.append("payment_receipt",s.receiptFile);const d=await f.post("/facility-bookings",l,{headers:{"Content-Type":"multipart/form-data"}});console.log("Response data:",d.data),d.data.success?(F(d.data.reference_number),h()):alert(d.data.message||"Booking failed. Please try again.")}catch(l){if(console.error("Booking error:",l),l.response?.data?.errors){const d=Object.values(l.response.data.errors).flat().join(`
`);alert(`Validation errors:
`+d)}else alert("An error occurred while creating your booking. Please try again.")}};return e.jsxs(H,{children:[e.jsx(E,{title:"Book a Facility"}),e.jsx("div",{className:"py-8",children:e.jsxs("div",{className:"mx-auto max-w-7xl px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Book a Facility"}),e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:"Reserve ODEC facilities for your events"})]}),e.jsx("div",{className:"mb-8",children:e.jsx("div",{className:"flex items-center justify-between",children:y.map((a,r)=>e.jsxs("div",{className:"flex items-center flex-1",children:[e.jsxs("div",{className:"flex flex-col items-center flex-1",children:[e.jsx("div",{className:`flex items-center justify-center w-12 h-12 rounded-full border-2 ${t>=a.number?"bg-blue-600 border-blue-600":"bg-white border-gray-300"}`,children:e.jsx(a.icon,{className:`h-6 w-6 ${t>=a.number?"text-white":"text-gray-400"}`})}),e.jsx("p",{className:`mt-2 text-xs font-medium ${t>=a.number?"text-blue-600":"text-gray-500"}`,children:a.name})]}),r<y.length-1&&e.jsx("div",{className:`flex-1 h-0.5 mx-4 ${t>a.number?"bg-blue-600":"bg-gray-300"}`})]},a.number))})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[t===1&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-6",children:"Select a Facility"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:k.map(a=>e.jsxs("div",{className:"border border-gray-200 rounded-lg overflow-hidden hover:shadow-lg transition-shadow cursor-pointer",onClick:()=>R(a),children:[e.jsx("img",{src:a.image,alt:a.name,className:"w-full h-48 object-cover"}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:a.name}),e.jsxs("span",{className:"text-blue-600 font-bold",children:["$",a.price_per_hour,"/hour"]})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:a.description}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Capacity: ",a.capacity]}),e.jsx("button",{className:"mt-4 w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700",children:"Select"})]})]},a.id))})]}),t===2&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-6",children:"Choose Date & Time"}),e.jsxs("div",{className:"max-w-md mx-auto space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Selected Facility"}),e.jsxs("div",{className:"p-4 bg-blue-50 rounded-lg",children:[e.jsx("p",{className:"font-semibold text-gray-900",children:s.facility?.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:["$",s.facility?.price_per_hour,"/hour"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Date"}),e.jsx("input",{type:"date",value:s.date,onChange:a=>n({...s,date:a.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",min:new Date().toISOString().split("T")[0]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Time Slot"}),_?e.jsx("div",{className:"text-center py-4 text-gray-500",children:"Loading available slots..."}):s.date?e.jsx("div",{className:"grid grid-cols-2 gap-3",children:M.map(a=>{const r=D(a.value),o=s.time===a.value;return e.jsxs("button",{type:"button",disabled:r,onClick:()=>!r&&n({...s,time:a.value}),className:`p-3 rounded-lg border-2 text-center transition-all ${r?"bg-red-100 border-red-300 text-red-500 cursor-not-allowed":o?"bg-blue-600 border-blue-600 text-white":"bg-green-50 border-green-300 text-green-700 hover:bg-green-100 cursor-pointer"}`,children:[e.jsx("div",{className:"font-semibold",children:a.label}),e.jsx("div",{className:"text-xs mt-1",children:r?"Booked":"Available"})]},a.value)})}):e.jsx("div",{className:"text-center py-4 text-gray-500",children:"Please select a date first"}),e.jsxs("div",{className:"flex gap-4 mt-3 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-3 h-3 bg-green-100 border border-green-300 rounded"}),e.jsx("span",{children:"Available"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-3 h-3 bg-red-100 border border-red-300 rounded"}),e.jsx("span",{children:"Booked"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-3 h-3 bg-blue-600 rounded"}),e.jsx("span",{children:"Selected"})]})]})]})]})]}),t===3&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-6",children:"Enter Booking Details"}),e.jsxs("div",{className:"max-w-md mx-auto space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Name"}),e.jsx("input",{type:"text",value:s.name,onChange:a=>n({...s,name:a.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email"}),e.jsx("input",{type:"email",value:s.email,onChange:a=>n({...s,email:a.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Phone"}),e.jsx("input",{type:"tel",value:s.phone,onChange:a=>n({...s,phone:a.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Number of Attendees"}),e.jsx("input",{type:"number",value:s.attendees,onChange:a=>n({...s,attendees:a.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Purpose of Booking"}),e.jsx("textarea",{value:s.purpose,onChange:a=>n({...s,purpose:a.target.value}),rows:3,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]})]}),t===4&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-6",children:"Payment"}),e.jsxs("div",{className:"max-w-md mx-auto space-y-6",children:[e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"Booking Summary"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Facility:"}),e.jsx("span",{className:"font-medium",children:s.facility?.name})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Date:"}),e.jsx("span",{className:"font-medium",children:s.date})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Time:"}),e.jsx("span",{className:"font-medium",children:s.time})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Duration:"}),e.jsx("span",{className:"font-medium",children:"4 hours"})]}),e.jsxs("div",{className:"flex justify-between pt-2 border-t border-gray-300",children:[e.jsx("span",{className:"font-semibold",children:"Total:"}),e.jsxs("span",{className:"font-bold text-blue-600",children:["$",x()]})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Payment Method"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center p-4 border border-gray-300 rounded-lg cursor-pointer hover:bg-gray-50",children:[e.jsx("input",{type:"radio",name:"payment",value:"cash",checked:s.paymentMethod==="cash",onChange:a=>n({...s,paymentMethod:a.target.value}),className:"mr-3"}),e.jsx("span",{children:"Cash on Arrival"})]}),e.jsxs("label",{className:"flex items-center p-4 border border-gray-300 rounded-lg cursor-pointer hover:bg-gray-50",children:[e.jsx("input",{type:"radio",name:"payment",value:"bank_transfer",checked:s.paymentMethod==="bank_transfer",onChange:a=>n({...s,paymentMethod:a.target.value}),className:"mr-3"}),e.jsx("span",{children:"Bank Transfer"})]})]})]}),(s.paymentMethod==="cash"||s.paymentMethod==="bank_transfer")&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Upload Payment Receipt",s.paymentMethod==="cash"&&e.jsx("span",{className:"text-amber-600 ml-1",children:"(10% Deposit Receipt)"})]}),e.jsx("div",{className:"mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-lg hover:border-blue-400 transition-colors",children:e.jsxs("div",{className:"space-y-1 text-center",children:[e.jsx(L,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsxs("div",{className:"flex text-sm text-gray-600",children:[e.jsxs("label",{htmlFor:"receipt-upload",className:"relative cursor-pointer bg-white rounded-md font-medium text-blue-600 hover:text-blue-500 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-blue-500",children:[e.jsx("span",{children:"Upload a file"}),e.jsx("input",{id:"receipt-upload",name:"receipt-upload",type:"file",accept:"image/*,.pdf",className:"sr-only",onChange:a=>{const r=a.target.files[0];r&&n({...s,receiptFile:r})}})]}),e.jsx("p",{className:"pl-1",children:"or drag and drop"})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"PNG, JPG, PDF up to 10MB"}),s.receiptFile&&e.jsxs("div",{className:"mt-2 flex items-center justify-center gap-2 text-sm text-green-600",children:[e.jsx(w,{className:"h-5 w-5"}),e.jsx("span",{children:s.receiptFile.name})]})]})}),s.paymentMethod==="cash"&&e.jsxs("div",{className:"mt-2 space-y-3",children:[e.jsx("div",{className:"p-3 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("p",{className:"text-xs text-blue-800",children:[e.jsx("strong",{children:"Bank Details for Deposit Transfer:"}),e.jsx("br",{}),"Maybank - ODEC UMS Beach Club",e.jsx("br",{}),"Account: 1234567890",e.jsx("br",{}),"Amount: $",(parseFloat(x())*.1).toFixed(2)," (10% deposit)"]})}),m&&e.jsxs("div",{className:"p-4 bg-white border-2 border-blue-300 rounded-lg",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900 mb-2 text-center",children:"Scan QR Code to Pay"}),e.jsx("img",{src:`/storage/${m}`,alt:"Payment QR Code",className:"max-w-full h-auto mx-auto rounded",style:{maxHeight:"250px"}}),e.jsx("p",{className:"text-xs text-gray-600 text-center mt-2",children:"Scan this QR code with your banking app to pay the deposit"})]})]}),s.paymentMethod==="bank_transfer"&&e.jsxs("div",{className:"mt-2 space-y-3",children:[e.jsx("div",{className:"p-3 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("p",{className:"text-xs text-blue-800",children:[e.jsx("strong",{children:"Bank Details for Full Payment:"}),e.jsx("br",{}),"Maybank - ODEC UMS Beach Club",e.jsx("br",{}),"Account: 1234567890",e.jsx("br",{}),"Amount: $",x()]})}),m&&e.jsxs("div",{className:"p-4 bg-white border-2 border-blue-300 rounded-lg",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900 mb-2 text-center",children:"Scan QR Code to Pay"}),e.jsx("img",{src:`/storage/${m}`,alt:"Payment QR Code",className:"max-w-full h-auto mx-auto rounded",style:{maxHeight:"250px"}}),e.jsx("p",{className:"text-xs text-gray-600 text-center mt-2",children:"Scan this QR code with your banking app to pay the full amount"})]})]})]})]})]}),t===5&&e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
                                    @media print {
                                        body * {
                                            visibility: hidden;
                                        }
                                        .printable-area, .printable-area * {
                                            visibility: visible;
                                        }
                                        .printable-area {
                                            position: absolute;
                                            left: 0;
                                            top: 0;
                                            width: 100%;
                                        }
                                        .no-print {
                                            display: none !important;
                                        }
                                        .print-header {
                                            display: block !important;
                                            margin-bottom: 20px;
                                            padding-bottom: 20px;
                                            border-bottom: 2px solid #000;
                                        }
                                    }
                                    .print-header {
                                        display: none;
                                    }
                                `}),e.jsx("div",{className:"py-8 printable-area",children:e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsxs("div",{className:"print-header text-center",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"ODEC Booking System"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Facility Booking Confirmation"})]}),e.jsxs("div",{className:"text-center mb-8 no-print",children:[e.jsx(w,{className:"h-20 w-20 text-green-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Booking Confirmed!"}),e.jsx("p",{className:"text-gray-600",children:"Your booking has been successfully submitted."})]}),e.jsx("div",{className:"flex justify-end mb-4 no-print",children:e.jsxs("button",{onClick:T,className:"flex items-center gap-2 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors",children:[e.jsx(Q,{className:"h-5 w-5"}),"Print Confirmation"]})}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-6 mb-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6 pb-4 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Booking Details"}),e.jsxs("span",{className:"text-sm text-gray-600",children:["Reference: ",e.jsx("span",{className:"font-semibold text-gray-900",children:S})]})]}),e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{className:"flex items-start",children:[e.jsx(G,{className:"h-5 w-5 text-gray-400 mr-3 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Facility"}),e.jsx("p",{className:"font-medium text-gray-900",children:s.facility?.name})]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx(V,{className:"h-5 w-5 text-gray-400 mr-3 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Time"}),e.jsx("p",{className:"font-medium text-gray-900",children:s.time})]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx(v,{className:"h-5 w-5 text-gray-400 mr-3 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Date"}),e.jsx("p",{className:"font-medium text-gray-900",children:s.date})]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx(O,{className:"h-5 w-5 text-gray-400 mr-3 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Booked By"}),e.jsx("p",{className:"font-medium text-gray-900",children:s.name})]})]})]}),e.jsxs("div",{className:"pt-4 border-t border-gray-200",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Payment Method"}),e.jsxs("span",{className:"font-medium text-gray-900",children:[s.paymentMethod==="credit_card"&&"Credit Card",s.paymentMethod==="cash"&&"Cash on Arrival",s.paymentMethod==="bank_transfer"&&"Bank Transfer"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-semibold text-gray-900",children:"Amount Paid"}),e.jsxs("span",{className:"font-bold text-lg text-green-600",children:["$",x()]})]})]})]}),e.jsx("div",{className:"text-center mb-6",children:e.jsxs("p",{className:"text-sm text-gray-600",children:["A confirmation email has been sent to ",e.jsx("span",{className:"font-medium text-gray-900",children:s.email})," with all the booking details."]})}),e.jsxs("div",{className:"flex gap-4 justify-center no-print",children:[e.jsx("button",{onClick:()=>window.location.href="/book-facility",className:"px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 font-medium",children:"Make Another Booking"}),e.jsx("button",{onClick:()=>window.location.href="/my-bookings",className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium",children:"View My Bookings"})]})]})})]}),t<5&&e.jsxs("div",{className:"flex justify-between mt-8 pt-6 border-t border-gray-200",children:[e.jsx("button",{onClick:P,disabled:t===1,className:"px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Back"}),e.jsx("button",{onClick:t===4?A:h,disabled:t===2&&(!s.date||!s.time)||t===3&&(!s.phone||!s.attendees||!s.purpose)||t===4&&!s.paymentMethod,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:t===4?"Confirm Booking":"Next"})]})]})]})})]})}export{ee as default};
